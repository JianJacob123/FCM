<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Socket.IO Vehicle Test</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #vehicles { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; margin-bottom: 10px; }
    button { padding: 8px; margin-top: 5px; }
  </style>
</head>
<body>
  <h2>üöó Vehicle Updates Test</h2>

  <div>
    <label>User ID: <input id="userId" value="1"></label>
    <button onclick="connectSocket()">Connect</button>
    <button onclick="subscribeVehicles()">Subscribe to Updates</button>
  </div>

  <div id="vehicles"></div>

  <script>
    let socket;

    function connectSocket() {
      const userId = document.getElementById("userId").value;

      socket = io("http://localhost:8080", {
        query: { userId }
      });

      socket.on("connect", () => console.log(`‚úÖ Connected as ${socket.id}`));
      socket.on("disconnect", () => console.log("‚ùå Disconnected"));

      socket.on("vehicleUpdate", (vehicles) => {
        const vBox = document.getElementById("vehicles");
        vBox.innerHTML = "";
        vehicles.forEach(v => {
          const div = document.createElement("div");
          div.textContent = `üöê Vehicle ${v.vehicle_id}: ${v.lat}, ${v.lng}, ${v.route_name}, ${v.end_lat}, ${v.end_lng}`;
          vBox.appendChild(div);
        });
      });
    }

    function subscribeVehicles() {
      if (socket) {
        socket.emit("subscribeVehicles");
      }
    }
  </script>
</body>
</html>
